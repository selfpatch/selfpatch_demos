# ros2_medkit gateway configuration for MoveIt 2 Panda demo
# Node runs under /diagnostics namespace, so we need to match that here
diagnostics:
  ros2_medkit_gateway:
    ros__parameters:
      server:
        # Bind to all interfaces for Docker networking
        host: "0.0.0.0"
        port: 8080

      refresh_interval_ms: 10000  # 10 seconds (default), reduces log spam

      cors:
        # Restrict origins to localhost by default; add explicit origins
        # (e.g., "http://your-ui-host:3000") for cross-host access.
        allowed_origins: ["http://localhost:8080", "http://localhost:3000"]
        allowed_methods: ["GET", "PUT", "POST", "DELETE", "OPTIONS"]
        allowed_headers: ["Content-Type", "Accept"]
        allow_credentials: false
        max_age_seconds: 86400

      max_parallel_topic_samples: 10

      # Discovery configuration
      discovery_mode: "hybrid"  # runtime_only, manifest_only, or hybrid
      manifest_path: ""  # Will be set via launch argument
      manifest_strict_validation: true

      discovery:
        runtime:
          create_synthetic_components: false  # Manifest defines components

# Fault Manager configuration (runs in root namespace)
fault_manager:
  ros__parameters:
    # Storage configuration
    storage_type: "sqlite"
    database_path: "/tmp/ros2_medkit/faults.db"

    # Debounce configuration
    confirmation_threshold: 0  # Immediate confirmation for demo
    healing_enabled: false
    auto_confirm_after_sec: 0.0

    # Snapshot configuration (freeze frames)
    snapshots:
      enabled: true
      background_capture: false  # On-demand capture when fault occurs
      timeout_sec: 2.0
      max_message_size: 131072  # 128KB max per message

      # Topics to capture for all faults
      default_topics:
        - /joint_states
        - /move_action/_action/status
        - /panda_arm_controller/follow_joint_trajectory/_action/status
        - /diagnostics
